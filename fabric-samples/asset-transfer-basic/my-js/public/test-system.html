<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System test - RiceTrace</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>RiceTrace system test</h1>
        
        <div class="section">
            <h2>Service status check</h2>
            <p>Basic API service is running</p>
        </div>

        <div class="section">
            <h2>Complete process test</h2>
            <p>Test: Upload report → Create batch → Complete the full process of transferring batches</p>
            <ol>
                <li><a href="upload-report.html">1. Upload quality inspection report</a></li>
                <li>2. Change the report status to APPROVED in the Supabase backend</li>
                <li><a href="create.html">3. Create batch (use report ID)</a></li>
                <li><a href="upload-report.html">4. Upload new quality inspection report</a></li>
                <li>5. Review and approve the new report</li>
                <li><a href="transfer.html">6. Transfer batch (use new report ID)</a></li>
                <li><a href="detail.html">7. View batch details</a></li>
            </ol>
        </div>

        <div class="section">
            <h2>API endpoint test</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="testAPI('/reports/status')">Report service status</button>
                <button onclick="testAPI('/reports/my')">My report list</button>
                <button onclick="testAPI('/oracle/status')">Oracle status</button>
                <button onclick="testAPI('/batch/stats')">Batch statistics</button>
                <button onclick="testAPI('/batch')">Batch list</button>
                <button onclick="testAPI('/health')">System health</button>
            </div>
            <div id="apiTestResult"></div>
        </div>

        <div class="navigation">
            <a href="index.html">Return to home page</a>
        </div>
    </div>

    <script src="common.js"></script>
    <script>

        // Test API endpoint
        async function testAPI(endpoint) {
            const resultDiv = document.getElementById('apiTestResult');
            showLoading('apiTestResult', `Test ${endpoint}...`);

            try {
                const result = await apiRequest('GET', endpoint, null, 'farmer');
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <h3>✅ ${endpoint} test successful</h3>
                        <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;">
${JSON.stringify(result, null, 2)}
                        </pre>
                    </div>
                `;
            } catch (error) {
                showError('apiTestResult', `${endpoint} test failed: ${error.message}`);
            }
        }

        // Page loaded
        window.addEventListener('load', () => {
            console.log('System test page loaded');
        });
    </script>
</body>
</html> 